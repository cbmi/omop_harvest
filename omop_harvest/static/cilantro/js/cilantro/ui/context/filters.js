define(["underscore","marionette","../base","../core","../../utils/numbers"],function(t,e,i,n,s){var o=function(e,i,n,s){return e?(i||(i=[]),s!==!1&&(s=!0),s&&i.push("<ul>"),e.language?i.push("<li>"+e.language+"</li>"):e.type&&e.children.length&&(n&&i.push("<li><small>"+e.type.toUpperCase()+"</small><ul>"),t.each(e.children,function(t){o(t,i,n,!1)}),n&&i.push("</ul></li>")),s&&i.push("</ul>"),i.join("")):""},r=e.ItemView.extend({className:"context-filter",template:"context/filter",ui:{actions:"[data-target=actions]",loader:"[data-target=loader]",remove:"[data-action=remove]",enable:"[data-action=enable]",description:"[data-target=description]",required:"[data-target=required]"},events:{click:"clickShow","click @ui.remove":"clickRemove","click @ui.enable":"toggleEnabled"},modelEvents:{request:"showLoadView",sync:"hideLoadView",error:"hideLoadView",change:"render"},simpleLanguage:{"in":["is","is"],"-in":["not","is not"],exact:["is","is"],range:["between","is between"],"-range":["not between","is not between"],isnull:["is","is"],gt:[">","is greater"],gte:[">=","is greater than or equal to"],lt:["<","is less"],lte:["<=","is less than or equal to"]},clickShow:function(){n.trigger(n.CONCEPT_FOCUS,this.model.get("concept"))},clickRemove:function(t){t.stopPropagation(),this.model.unapply()},toggleEnabled:function(t){t.stopPropagation(),this.model.toggleEnabled()},renderEnabled:function(){this.$el.removeClass("disabled"),this.ui.enable.attr("title","Disable"),this.ui.enable.prop("checked",!0)},renderDisabled:function(){this.$el.addClass("disabled"),this.ui.enable.attr("title","Enable"),this.ui.enable.prop("checked",!1)},renderState:function(){this.model.get("enabled")!==!1?this.renderEnabled():this.renderDisabled()},parseValue:function(e,i){var s,o=[];if(!t.isArray(e))return"undefined"!=typeof e.label&&(e=e.label),"<span class=filter-value>"+e+"</span>";var r=n.config.get("maxFilterDisplayValues");if("object"==typeof e[0]&&(e=t.pluck(e,"label")),1===e.length)return"<span class=filter-value>"+e[0]+"</span>";if(e.length<r){for(s=0;s<e.length-1;s++)o.push("<span class=filter-value>"+e[s]+","+"</span>");"-"===i.charAt(0)?o.push("nor"):o.push("or"),o.push("<span class=filter-value>"+e[e.length-1]+"</span>")}else{o.push("<span class=filter-value>"+e[0]+","+"</span>"),o.push("<span class=filter-value>"+e[1]+","+"</span>");var a=e.length-r;i.indexOf("-")<0?o.push("...("+a+" more) or"):o.push("...("+a+" more) nor"),o.push("<span class=filter-value>"+e[e.length-1]+"</span>")}return o.join(" ")},renderDescription:function(){var e=this.model.toJSON();if(!n.config.get("styleFilters"))return this.ui.description.html(o(e)),void 0;var i=e.cleaned_value,r=[],a=e.value,l=e.operator,c="";if("undefined"==typeof i&&(i=a),c=n.data.fields.get(e.field)?n.data.fields.get(e.field).get("name"):e.language.split(this.simpleLanguage[l][1])[0],c=c.replace(/[!?]$/g,""),r.push("<ul><li>"),r.push("<strong>"+c+"</strong>"),"range"===l||"-range"===l){r.push(this.simpleLanguage[l][0]);var h=a[0],u=a[1];t.isNumber(h)&&t.isNumber(u)&&(h=s.toDelimitedNumber(h),u=s.toDelimitedNumber(u)),r.push("<span class=filter-value>"+h+"</span> and "+"<span class=filter-value>"+u+"</span>")}else"in"===l||"-in"===l?(r.push(this.simpleLanguage[l][0]),r.push(this.parseValue(i,l))):(r.push(this.simpleLanguage[l][0]),r.push(this.parseValue(i,l)));r.push("</li></ul>"),this.ui.description.html(r.join(" "))},showLoadView:function(){this.ui.loader.show(),this.ui.description.hide()},hideLoadView:function(){this.ui.loader.hide(),this.ui.description.show()},onRender:function(){this.ui.actions.toggle(!this.model.get("required")),this.ui.enable.toggle(!this.model.get("required")),this.ui.required.toggle(this.model.get("required")===!0),this.ui.required.tooltip({container:"body",placement:"left",delay:500}),this.renderDescription(),this.renderState()}}),a=i.EmptyView.extend({template:"context/empty",ui:{noFiltersResultsMessage:".no-filters-results-workspace",noFiltersQueryMessage:".no-filters-query-workspace"},onRender:function(){this.listenTo(n.router,"route",this.toggleMessage),this.toggleMessage()},onClose:function(){this.stopListening(n.router)},toggleMessage:function(){n.router.isCurrent("results")?(this.ui.noFiltersQueryMessage.hide(),this.ui.noFiltersResultsMessage.show()):n.router.isCurrent("query")&&(this.ui.noFiltersQueryMessage.show(),this.ui.noFiltersResultsMessage.hide())}}),l=e.CollectionView.extend({itemView:r,emptyView:a});return{ContextFilter:r,ContextFilters:l,ContextNoFilters:a,flattenLanguage:o}});
//@ sourceMappingURL=filters.js.map